package com.citycreek.of;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.Date;
import java.util.LinkedHashSet;
import java.util.List;
import java.util.Set;

import com.cjc.util.LangUtil;

public abstract class Exporter {

	private int count = 0;
	private char delimiter;
	private final Set<Long> orderIds = new LinkedHashSet<>();
	protected final StringBuilder iff = new StringBuilder();

	public Exporter(char delimiter) {
		this.delimiter = delimiter;
	}

	public int getCount() {
		return this.count;
	}

	public Set<Long> getOrderIds() {
		return this.orderIds;
	}

	public abstract Exporter exportOrders(List<Order> orders);

	protected abstract String getFileExtension();

	public Path write(Path parent) throws IOException {
		String filename = LangUtil.getDateTimeString(new Date(), "yyyyMMddHHmm") + this.getFileExtension();
		Path file = parent.resolve(filename);
		Files.write(file, this.iff.toString().getBytes());
		return file;
	}
	
	final protected void addOrderId(long orderId) {
		this.orderIds.add(orderId);
	}

	protected void column(String value, boolean quotes) {
		if (quotes) {
			this.iff.append("\"").append(value).append("\"").append(this.delimiter);
		} else {
			this.iff.append(value).append(this.delimiter);
		}
	}

	protected void column(String value) {
		this.column(value, true);
	}

	protected void column(Number value) {
		this.column(value.toString(), false);
	}

	protected void rowEnd() {
		this.iff.append("\n");
		this.count++;
	}

	protected void headerRow(String header) {
		this.iff.append(header).append("\n");
	}

	protected void skip() {
		this.iff.append(this.delimiter);
	}
}
